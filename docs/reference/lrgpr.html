<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit a Low Rank Gaussian Process Regression (LRGPR) / Linear Mixed Model (LMM) — lrgpr • lrgpr</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a Low Rank Gaussian Process Regression (LRGPR) / Linear Mixed Model (LMM) — lrgpr"><meta property="og:description" content="Fit LRGPR/LMM models that account for covariance in response values, but where the scale of the covariance is unknown.  Standard linear modeling syntax is used for the model specification in addition to a covariance matrix or its eigen-decomposition."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lrgpr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a Low Rank Gaussian Process Regression (LRGPR) / Linear Mixed Model (LMM)</h1>
    
    <div class="hidden name"><code>lrgpr.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit LRGPR/LMM models that account for covariance in response values, but where the scale of the covariance is unknown.  Standard linear modeling syntax is used for the model specification in addition to a covariance matrix or its eigen-decomposition.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">lrgpr</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">decomp</span>,</span>
<span>  rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">decomp</span><span class="op">$</span><span class="va">u</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">decomp</span><span class="op">$</span><span class="va">vectors</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  delta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nthreads <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  W_til <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  diagnostic <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>standard linear modeling syntax as used in `lm'</p></dd>


<dt>decomp</dt>
<dd><p>eigen-decomposition produced from eigen(K), where K is the covariance matrix.  Or singular value decomposition svd(X[,1:100]) based on a subset of markers</p></dd>


<dt>rank</dt>
<dd><p>decomposition is truncated to the first rank eigen-vectors</p></dd>


<dt>delta</dt>
<dd><p>ratio of variance components governing the fit of the model.  This should be estimated from a previous evaluation of `lm' on the same response and eigen-decomposition</p></dd>


<dt>nthreads</dt>
<dd><p>number of threads to use for parallel execution</p></dd>


<dt>W_til</dt>
<dd><p>markers used to construct decomp that should now be removed from costruction of decomp.  This is the proximal contamination term of Listgarten, et al. (2012)</p></dd>


<dt>scale</dt>
<dd><p>should W_til be scaled and centered</p></dd>


<dt>diagnostic</dt>
<dd><p>compute diagnostic statistics to be used with plot()</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <dl><dt>coefficients</dt>
<dd><p>regression coefficients for each covariate</p></dd>

<dt>p.values</dt>
<dd><p>p-values from Wald test of each coefficient</p></dd>

<dt>sd</dt>
<dd><p>standard deviation of each coefficient estimate</p></dd>

<dt>sigSq_e</dt>
<dd><p>variance component $$\sigma^2_e$$ corresponding to the residual error</p></dd>

<dt>sigSq_a</dt>
<dd><p>variance component $$\sigma^2_a$$ corresponding the scale of the covariance, K</p></dd>

<dt>delta</dt>
<dd><p>ratio of variance components: $$\sigma^2_e / \sigma^2_a$$</p></dd>

<dt>rank</dt>
<dd><p>the rank of the random effect</p></dd>

<dt>logLik</dt>
<dd><p>log-likelihood of the model fit</p></dd>

<dt>fitted.values</dt>
<dd><p>estimated response values: y_hat</p></dd>

<dt>alpha</dt>
<dd><p>BLUP of the random effect</p></dd>

<dt>Sigma</dt>
<dd><p>variance-covariate matrix of estimate of beta</p></dd>

<dt>hii</dt>
<dd><p>diagonals of the matrix H such that y_hat = Hy</p></dd>

<dt>y</dt>
<dd><p>responses</p></dd>

<dt>x</dt>
<dd><p>design matrix</p></dd>

<dt>df</dt>
<dd><p>effective degrees of freedom: trace(H) based on Hoffman (2013)</p></dd>

<dt>residuals</dt>
<dd><p>residuals of model fit: y - y_hat</p></dd>

<dt>AIC</dt>
<dd><p>Akaike information criterion</p></dd>

<dt>BIC</dt>
<dd><p>Bayesian information criterion</p></dd>

<dt>GCV</dt>
<dd><p>generalized cross-validation</p></dd>

<dt>eigenVectors</dt>
<dd><p>eigen-vectors in decomp</p></dd>

<dt>eigenValues</dt>
<dd><p>eigen-values in decomp</p></dd>

<dt>df.residual</dt>
<dd><p>n - ncol(X)</p></dd>

<dt>rank</dt>
<dd><p>rank of decomposition used, where only non-negative eigen/singular values are considered</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    

<p><code>lrgpr</code> fits the model:
$$ y = X \beta + \alpha + \epsilon$$</p>
<p>$$\alpha \sim N(0, K \sigma^2_a)$$</p>
<p>$$\epsilon \sim N(0, \sigma^2_e)$$</p>
<p>where $$\delta = \sigma^2_e / \sigma^2_a$$</p>
<p>In practice the eigen-decomposition of K, and not K itself is required.  The rank can be set to use only eigen-vectors 1:rank in the model.</p>
<p>This package allows hypothesis tests of single coefficients using fit$p.values which fits a Wald test.  Composite hypothesis tests of multiple coefficients are performed with wald(fit, terms=1:3).</p>
<p>Note that likelihood ratio tests with linear mixed models do not perform well and the resulting p-values often do not follow a uniform distribution under the null (Pinheiro and Bates, 2000).  We strongly advise against using it with this model.</p>
<p><code>lrgpr</code> uses the algorithm of Lippert, et al. (2011).</p>
<p>See Hoffman (2013) for an interpretation of the linear mixed model.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Kang, H. M., et al. (2010) Variance component model to account for sample structure in genome-wide association studies. _Nature Genetics_ 42, 348-54</p>
<p>Lippert, C., et al. (2011) FaST linear mixed models for genome-wide association studies. _Nature Methods_ 9, 525-26</p>
<p>Listgarten, J., et al. (2012) Improved linear mixed models for genome-wide association studies. _Nature Methods_ 8, 833-5</p>
<p>Rasmussen, C. E. and Williams, C. K. I. (2006) Gaussian processes for machine learning. MIT Press</p>
<p>Pinheiro, J. C. and Bates, D. M. (2000) Mixed-Effects Models in S and S-PLUS. Springer, New York</p>
<p>Hoffman, G. E. (2013) Correcting for Population Structure and Kinship Using the Linear Mixed Model: Theory and Extensions. _PLoS ONE_ 8(10):e75707</p>
<p>Note that degrees freedom and some diagnostic statistics are not currently calculated when W_til is specified.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="wald.html">wald</a></code>, <code><a href="lrgprApply.html">lrgprApply</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Generate random data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">1000</span><span class="op">)</span>, ncol<span class="op">=</span><span class="va">n</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="va">n</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">decomp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the model</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">lrgpr</span><span class="op">(</span> <span class="va">y</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span>, <span class="va">decomp</span>, diagnostic<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>non-list contrasts argument ignored</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in lrgpr(y ~ sex + age, decomp, diagnostic = TRUE):</span> object 'X' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Print results</span></span></span>
<span class="r-in"><span><span class="va">fit</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'fit' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Print more detailed results </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'object' in selecting a method for function 'summary': object 'fit' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># P-values for each covariate</span></span></span>
<span class="r-in"><span><span class="va">fit</span><span class="op">$</span><span class="va">p.values</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'fit' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualize fit of the model like for `lm'</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'fit' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Composite hypothesis test using Wald's test</span></span></span>
<span class="r-in"><span><span class="co"># Joint test of coefficients 2:3</span></span></span>
<span class="r-in"><span><span class="fu"><a href="wald.html">wald</a></span><span class="op">(</span> <span class="va">fit</span>, terms<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in is.null(terms) || is.na(terms):</span> 'length = 2' in coercion to 'logical(1)'</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Gabriel E. Hoffman.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

